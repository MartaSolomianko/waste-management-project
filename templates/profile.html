{% extends 'base.html' %}
{% block title %}{% endblock %}
{% block head %}

<!-- CHART JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" integrity="sha512-ElRFoEQdI5Ht6kZvyzXhYG9NqjtkmlkfYk0wr6wHxU9JEHakS7UJZNeml5ALk+8IKlU6jDgMabC3vkumRokgJA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<!-- SWIPER JS -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css"
/>

{% endblock %}
{% block body %}

<!------------- USER INFO -------------------------------------->
<!-- <div>
    <h1>Hi {{ user.name }}!</h1>
</div> -->

<input type="hidden" id="user-id" value="{{ session.get('user_id') }}">

<!---------------- PIE CHART ----------------------------------------->
<div class="container">
  <div class="row">
    <div class="col-4">
      <div class="card">
        <div class="card-body">
      <!-- pie chart and counter of user's lifetime totals-->
          <div id="display-pie-chart">
            <canvas id="piechart"></canvas>
          </div>
        </div>
        <br>
        {% if records_dict %}
          <div>You have produced:</div>
            <h1 id="lifetime-total"></h1> 
            <div>At a rate of:</div>  
            <h2 id="daily-rate"></h2> 
          <div id="start-date">Since {{ start_date }}</div>
        {% endif %}
          </div>
        </div>

<!----------------- BUTTONS TO LOG A NEW RECORD ------------------------------->
    <div class="col-8">
     <div class="row">
      <button id="log-bag" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#show-log-bag-modal">Log a bag of waste</button>
      <a href="/profile/search" id="log-item-btn" class="btn btn-primary">Look up an item to Log</a>
    </div>

<!----------------- SHOW USER RECORDS AS GRID ON PROFILE ---------------------->
<br>
  <div class="container carousel">
  <!-- Swiper -->
    <div dir="rtl" class="swiper mySwiper">
      <div class="swiper-wrapper">
        {% for date in records_dict %}
          <div class="swiper-slide">
            <div class="card">
              <div class="card-header">
                {{ date }}
              </div>
                <div class="card-body">

                  <div id="display-record" class="flex-container">
                    {% for record in records_dict[date] %}
                      <div id="record-{{ record.record_id }}" value="{{ record.record_id }}">
                        <button class="btn btn-primary modal-btn user-record-btn" data-bs-toggle="modal" data-bs-target="#show-record-modal" value="{{ record.record_id }}">
                          <p value="{{ record.record_id }}">{{ record.bin_type_code }}</p>
                          <p value="{{ record.record_id }}">Date - {{ record.date_time }}</p>
                          <p value="{{ record.record_id }}">Weight - {{ record.weight }} lbs</p>
                        </button>
                      </div>
                    {% endfor %}
                  </div>

                </div>
              </div>
            </div>
        {% endfor %}
      </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>
</div>

 <!----------------- MODAL FOR EACH INDIVIDUAL USER RECORD  ----------------->
<div class="modal fade" id="show-record-modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="record">RECORD</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <!-- form to DELETE RECORD -->
        <form id="show-record">
          <div class="modal-body">
            <!-- WHERE THE INDIVIDUAL RECORD DETAILS SHOW UP -->
            <div id="show-a-record"></div>
          </div>
          <div class="modal-footer">
            <!-- MAKE AN EDIT BUTTON HERE? -->
            <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Edit</button> -->
            <input type="submit" id="delete-record-btn" data-bs-dismiss="modal" class="btn btn-primary delete-record" value="Delete"></button>
          </div>
        </form>
      </div>
    </div>
  </div>

<!------------- MODAL TO ADD A BAG OF WASTE TO Records table in DB -------------------------->
<div class="modal fade" id="show-log-bag-modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="add-bag">Log a bag of waste</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <!-- form to record a bag of waste -->
      <form id="addrecord">
        <label for="add-record"></label>
      <div>
        <p>
          <label for="bintype">Select a bin type:</label>
            <select id="bin-type">
              <option value="T">Trash</option>
              <option value="C">Compost</option>
              <option value="R">Recycle</option>
              <option value="H">Hazard</option>
            </select>
        </p>
      </div>
    <div>
      <p>
        <label for="weight">Weight:</label>
          <input type="text" id="weight" placeholder="weight in pounds"><span> lbs</span> 
    </div> 
      <input type="submit" data-bs-dismiss="modal" value="Add record">
      </form>
    </div>
  </div>
</div>



<!----------------- JS SCRIPTS FOR PROFILE ------------------------------>

<script src="/static/profile.js"></script>

<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>

 <!-- Initialize Swiper -->
 <script>
  var swiper = new Swiper(".mySwiper", {
    slidesPerView: 1,
    allowTouchMove: false,
    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },
    navigation: {
      nextEl: ".swiper-button-next",
      prevEl: ".swiper-button-prev",
    },
  });
</script>

{% endblock %}